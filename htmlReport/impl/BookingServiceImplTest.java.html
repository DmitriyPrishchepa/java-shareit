<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ru"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BookingServiceImplTest.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">java in server Coverage Results</a> &gt; <a href="index.source.html" class="el_package">impl</a> &gt; <span class="el_source">BookingServiceImplTest.java</span></div><h1>BookingServiceImplTest.java</h1><pre class="source lang-java linenums">package impl;

import jakarta.persistence.EntityManager;
import jakarta.persistence.EntityNotFoundException;
import jakarta.persistence.TypedQuery;
import org.hamcrest.Matchers;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.InjectMocks;
import org.mockito.Mock;
import org.mockito.Mockito;
import org.mockito.junit.jupiter.MockitoExtension;
import org.mockito.junit.jupiter.MockitoSettings;
import org.mockito.quality.Strictness;
import ru.practicum.shareit.booking.BookingRepository;
import ru.practicum.shareit.booking.BookingService;
import ru.practicum.shareit.booking.BookingServiceImpl;
import ru.practicum.shareit.booking.dto.BookingDto;
import ru.practicum.shareit.booking.dto.BookingDtoToReturn;
import ru.practicum.shareit.booking.mapper.BookingMapper;
import ru.practicum.shareit.booking.model.Booking;
import ru.practicum.shareit.booking.util.BookingState;
import ru.practicum.shareit.booking.util.BookingStateSearchParams;
import ru.practicum.shareit.exception.exceptions.BookingValidationException;
import ru.practicum.shareit.exception.exceptions.ElementNotFoundException;
import ru.practicum.shareit.exception.exceptions.MissingParameterException;
import ru.practicum.shareit.exception.exceptions.WrongUserException;
import ru.practicum.shareit.item.ItemRepository;
import ru.practicum.shareit.item.ItemService;
import ru.practicum.shareit.item.dto.ItemDto;
import ru.practicum.shareit.item.model.Item;
import ru.practicum.shareit.request.model.Request;
import ru.practicum.shareit.user.UserRepository;
import ru.practicum.shareit.user.UserService;
import ru.practicum.shareit.user.dto.UserDto;
import ru.practicum.shareit.user.model.User;

import java.time.LocalDateTime;
import java.util.List;

import static org.hamcrest.MatcherAssert.assertThat;
import static org.hamcrest.Matchers.*;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.mockito.Mockito.mock;

@ExtendWith(MockitoExtension.class)
@MockitoSettings(strictness = Strictness.LENIENT)
<span class="fc" id="L50">public class BookingServiceImplTest {</span>

    @Mock
    UserRepository userRepository;

    @Mock
    ItemRepository itemRepository;

    @Mock
    BookingRepository bookingRepository;

    @Mock
    BookingMapper bookingMapper;

    @Mock
    UserService userService;

    @Mock
    ItemService itemService;

    @Mock
    BookingService bookingService;

    @InjectMocks
    BookingServiceImpl bookingServiceImpl;

    @Mock
    EntityManager entityManager;

    UserDto userDto;
    ItemDto itemDto;
    BookingDto bookingDto;
    User mockedUser;
    Item mockedItem;
    Booking mockedBooking;
    TypedQuery&lt;User&gt; mockUserQuery;
    TypedQuery&lt;Item&gt; mockItemQuery;
    TypedQuery&lt;Booking&gt; mockBookingQuery;
    BookingDtoToReturn returnedBookingDto;

    Booking checkBooking;
    BookingDtoToReturn checkBookingDtoToReturn;

    private BookingDtoToReturn mapToReturn(
            Long id,
            LocalDateTime start,
            LocalDateTime end,
            User booker,
            Item item,
            BookingState bookingState
    ) {
<span class="fc" id="L101">        BookingDtoToReturn dto = new BookingDtoToReturn();</span>
<span class="fc" id="L102">        dto.setId(id);</span>
<span class="fc" id="L103">        dto.setStart(start);</span>
<span class="fc" id="L104">        dto.setEnd(end);</span>
<span class="fc" id="L105">        dto.setBooker(booker);</span>
<span class="fc" id="L106">        dto.setItem(item);</span>
<span class="fc" id="L107">        dto.setStatus(bookingState);</span>
<span class="fc" id="L108">        return dto;</span>
    }

    @BeforeEach
    void setUp() {

<span class="fc" id="L114">        userDto = new UserDto();</span>
<span class="fc" id="L115">        userDto.setName(&quot;user1&quot;);</span>
<span class="fc" id="L116">        userDto.setEmail(&quot;user1@mail.ru&quot;);</span>

<span class="fc" id="L118">        mockedUser = mock(User.class);</span>
<span class="fc" id="L119">        Mockito.when(mockedUser.getId()).thenReturn(1L);</span>
<span class="fc" id="L120">        Mockito.when(mockedUser.getName()).thenReturn(&quot;user1&quot;);</span>
<span class="fc" id="L121">        Mockito.when(mockedUser.getEmail()).thenReturn(&quot;user1@mail.ru&quot;);</span>

<span class="fc" id="L123">        mockUserQuery = mock(TypedQuery.class);</span>

<span class="fc" id="L125">        Mockito.when(userService.createUser(Mockito.any(UserDto.class)))</span>
<span class="fc" id="L126">                .thenReturn(userDto);</span>

<span class="fc" id="L128">        Mockito.when(mockUserQuery.setParameter(Mockito.anyString(), Mockito.anyString()))</span>
<span class="fc" id="L129">                .thenReturn(mockUserQuery);</span>

<span class="fc" id="L131">        Mockito.when(mockUserQuery</span>
<span class="fc" id="L132">                        .getSingleResult())</span>
<span class="fc" id="L133">                .thenReturn(mockedUser);</span>

<span class="fc" id="L135">        userService.createUser(userDto);</span>

        //--------------------------------------

<span class="fc" id="L139">        itemDto = new ItemDto();</span>
<span class="fc" id="L140">        itemDto.setName(&quot;item1&quot;);</span>
<span class="fc" id="L141">        itemDto.setDescription(&quot;item1Descr&quot;);</span>
<span class="fc" id="L142">        itemDto.setOwnerId(mockedUser.getId());</span>
<span class="fc" id="L143">        itemDto.setAvailable(true);</span>

<span class="fc" id="L145">        mockedItem = mock(Item.class);</span>
<span class="fc" id="L146">        Mockito.when(mockedItem.getName()).thenReturn(&quot;item1&quot;);</span>
<span class="fc" id="L147">        Mockito.when(mockedItem.getDescription()).thenReturn(&quot;item1Descr&quot;);</span>
<span class="fc" id="L148">        Mockito.when(mockedItem.getOwnerId()).thenReturn(1L);</span>
<span class="fc" id="L149">        Mockito.when(mockedItem.getAvailable()).thenReturn(true);</span>

<span class="fc" id="L151">        mockItemQuery = mock(TypedQuery.class);</span>

<span class="fc" id="L153">        Mockito.when(itemService.addItem(Mockito.anyLong(), Mockito.any(ItemDto.class)))</span>
<span class="fc" id="L154">                .thenReturn(itemDto);</span>

<span class="fc" id="L156">        Mockito.when(mockItemQuery.setParameter(Mockito.anyString(), Mockito.anyString()))</span>
<span class="fc" id="L157">                .thenReturn(mockItemQuery);</span>

<span class="fc" id="L159">        Mockito.when(mockItemQuery.getSingleResult())</span>
<span class="fc" id="L160">                .thenReturn(mockedItem);</span>

<span class="fc" id="L162">        itemService.addItem(mockedUser.getId(), itemDto);</span>

        //------------------------------------------

        //request

<span class="fc" id="L168">        bookingDto = new BookingDto();</span>
<span class="fc" id="L169">        bookingDto.setItemId(1L);</span>
<span class="fc" id="L170">        bookingDto.setStatus(BookingState.WAITING);</span>
<span class="fc" id="L171">        bookingDto.setStart(LocalDateTime.of(2024, 11, 11, 11, 11, 11));</span>
<span class="fc" id="L172">        bookingDto.setEnd(LocalDateTime.of(2024, 12, 12, 12, 12, 12));</span>

<span class="fc" id="L174">        mockedBooking = mock(Booking.class);</span>

<span class="fc" id="L176">        mockedBooking = mock(Booking.class);</span>
<span class="fc" id="L177">        Mockito.when(mockedBooking.getId()).thenReturn(1L);</span>
<span class="fc" id="L178">        Mockito.when(mockedBooking.getStart()).thenReturn(bookingDto.getStart());</span>
<span class="fc" id="L179">        Mockito.when(mockedBooking.getEnd()).thenReturn(bookingDto.getEnd());</span>
<span class="fc" id="L180">        Mockito.when(mockedBooking.getStatus()).thenReturn(bookingDto.getStatus());</span>
<span class="fc" id="L181">        Mockito.when(mockedBooking.getItem()).thenReturn(mockedItem);</span>
<span class="fc" id="L182">        Mockito.when(mockedBooking.getBooker()).thenReturn(mockedUser);</span>

<span class="fc" id="L184">        mockBookingQuery = mock(TypedQuery.class);</span>

<span class="fc" id="L186">        returnedBookingDto = new BookingDtoToReturn();</span>
<span class="fc" id="L187">        returnedBookingDto.setId(1L);</span>
<span class="fc" id="L188">        returnedBookingDto.setStart(bookingDto.getStart());</span>
<span class="fc" id="L189">        returnedBookingDto.setEnd(bookingDto.getEnd());</span>
<span class="fc" id="L190">        returnedBookingDto.setStatus(bookingDto.getStatus());</span>
<span class="fc" id="L191">        returnedBookingDto.setItem(mockedItem);</span>
<span class="fc" id="L192">        returnedBookingDto.setBooker(mockedUser);</span>

<span class="fc" id="L194">        Mockito.when(bookingService.createBooking(Mockito.eq(userDto.getId()), Mockito.eq(bookingDto)))</span>
<span class="fc" id="L195">                .thenReturn(returnedBookingDto);</span>

<span class="fc" id="L197">        Mockito.when(mockBookingQuery.setParameter(Mockito.anyString(), Mockito.anyString()))</span>
<span class="fc" id="L198">                .thenReturn(mockBookingQuery);</span>

<span class="fc" id="L200">        Mockito.when(mockBookingQuery.getSingleResult())</span>
<span class="fc" id="L201">                .thenReturn(mockedBooking);</span>

<span class="fc" id="L203">        Mockito.when(entityManager.createQuery(Mockito.anyString(), Mockito.eq(Booking.class)))</span>
<span class="fc" id="L204">                .thenReturn(mockBookingQuery);</span>

        //для проверки состояний

<span class="fc" id="L208">        checkBooking = new Booking();</span>
<span class="fc" id="L209">        checkBooking.setStart(LocalDateTime.of(2026, 1, 1, 0, 0));</span>
<span class="fc" id="L210">        checkBooking.setEnd(LocalDateTime.of(2027, 1, 2, 0, 0)); // Дата окончания должна быть в прошлом</span>
<span class="fc" id="L211">        checkBooking.setItem(mockedItem);</span>
<span class="fc" id="L212">        checkBooking.setBooker(mockedUser);</span>
<span class="fc" id="L213">        checkBooking.setStatus(BookingState.APPROVED);</span>

<span class="fc" id="L215">        checkBookingDtoToReturn = mapToReturn(</span>
<span class="fc" id="L216">                checkBooking.getId(),</span>
<span class="fc" id="L217">                checkBooking.getStart(),</span>
<span class="fc" id="L218">                checkBooking.getEnd(),</span>
<span class="fc" id="L219">                checkBooking.getBooker(),</span>
<span class="fc" id="L220">                checkBooking.getItem(),</span>
<span class="fc" id="L221">                checkBooking.getStatus()</span>
        );

        //инструкции
<span class="fc" id="L225">        Mockito.when(userRepository.existsById(Mockito.anyLong())).thenReturn(true);</span>
<span class="fc" id="L226">        Mockito.when(itemRepository.existsById(Mockito.anyLong())).thenReturn(false);</span>
<span class="fc" id="L227">    }</span>

    @Test
    void createBookingTest() {

<span class="fc" id="L232">        mockBookingQuery = entityManager.createQuery(&quot;select b from Booking b&quot;, Booking.class);</span>
<span class="fc" id="L233">        Booking booking = mockBookingQuery.getSingleResult();</span>

<span class="fc" id="L235">        assertThat(booking.getId(), notNullValue());</span>
<span class="fc" id="L236">        assertThat(booking.getStart(), equalTo(bookingDto.getStart()));</span>
<span class="fc" id="L237">        assertThat(booking.getStatus(), equalTo(bookingDto.getStatus()));</span>
<span class="fc" id="L238">    }</span>

    @Test
    void createBookingUserNotFoundTest() {
<span class="fc" id="L242">        Mockito.when(userRepository.existsById(Mockito.anyLong())).thenReturn(false);</span>

        try {
<span class="nc" id="L245">            bookingServiceImpl.createBooking(userDto.getId(), new BookingDto());</span>
<span class="fc" id="L246">        } catch (ElementNotFoundException e) {</span>
<span class="fc" id="L247">            assertEquals(&quot;User not found&quot;, e.getMessage());</span>
<span class="nc" id="L248">        }</span>
<span class="fc" id="L249">    }</span>

    @Test
    void createBookingItemNotFoundTest() {

        try {
<span class="nc" id="L255">            bookingServiceImpl.createBooking(1L, bookingDto);</span>
<span class="fc" id="L256">        } catch (ElementNotFoundException e) {</span>
<span class="fc" id="L257">            assertEquals(&quot;Item not found&quot;, e.getMessage());</span>
<span class="nc" id="L258">        }</span>
<span class="fc" id="L259">    }</span>

    @Test
    void createBookingItemNotAvailableTest() {
<span class="fc" id="L263">        Mockito.when(userRepository.existsById(Mockito.anyLong())).thenReturn(true);</span>
<span class="fc" id="L264">        Mockito.when(itemRepository.existsById(Mockito.anyLong())).thenReturn(true);</span>

<span class="fc" id="L266">        Mockito.when(mockedItem.getAvailable())</span>
<span class="fc" id="L267">                .thenReturn(false);</span>

<span class="fc" id="L269">        Mockito.when(itemRepository.getReferenceById(Mockito.anyLong())).thenReturn(mockedItem);</span>

<span class="fc" id="L271">        Mockito.when(bookingMapper.mapFromDto(Mockito.any(BookingDto.class)))</span>
<span class="fc" id="L272">                .thenReturn(mockedBooking);</span>

<span class="fc" id="L274">        Mockito.when(bookingRepository.save(Mockito.eq(mockedBooking)))</span>
<span class="fc" id="L275">                .thenReturn(mockedBooking);</span>
        try {
<span class="nc" id="L277">            bookingServiceImpl.createBooking(1L, bookingDto);</span>
<span class="fc" id="L278">        } catch (BookingValidationException e) {</span>
<span class="fc" id="L279">            assertEquals(&quot;Item not available&quot;, e.getMessage());</span>
<span class="nc" id="L280">        }</span>
<span class="fc" id="L281">    }</span>

    @Test
    void createBookingStartDateEqualsEndDateTest() {
<span class="fc" id="L285">        Mockito.when(userRepository.existsById(Mockito.anyLong())).thenReturn(true);</span>
<span class="fc" id="L286">        Mockito.when(userRepository.getReferenceById(Mockito.anyLong())).thenReturn(mockedUser);</span>
<span class="fc" id="L287">        Mockito.when(itemRepository.existsById(Mockito.anyLong())).thenReturn(true);</span>
<span class="fc" id="L288">        Mockito.when(itemRepository.getReferenceById(Mockito.anyLong())).thenReturn(mockedItem);</span>

<span class="fc" id="L290">        BookingDto bookingDto1 = new BookingDto();</span>
<span class="fc" id="L291">        bookingDto1.setItemId(1L);</span>
<span class="fc" id="L292">        bookingDto1.setStatus(BookingState.WAITING);</span>
<span class="fc" id="L293">        bookingDto1.setStart(LocalDateTime.of(2024, 11, 11, 11, 11, 11));</span>
<span class="fc" id="L294">        bookingDto1.setEnd(LocalDateTime.of(2024, 11, 11, 11, 11, 11));</span>

<span class="fc" id="L296">        Mockito.when(bookingMapper.mapFromDto(Mockito.any(BookingDto.class)))</span>
<span class="fc" id="L297">                .thenReturn(mockedBooking);</span>

<span class="fc" id="L299">        Mockito.when(bookingRepository.save(Mockito.eq(mockedBooking)))</span>
<span class="fc" id="L300">                .thenReturn(mockedBooking);</span>

        try {
<span class="nc" id="L303">            bookingServiceImpl.createBooking(1L, bookingDto1);</span>
<span class="fc" id="L304">        } catch (BookingValidationException e) {</span>
<span class="fc" id="L305">            assertEquals(&quot;Booking start date cannot be equals booking end date&quot;, e.getMessage());</span>
<span class="nc" id="L306">        }</span>
<span class="fc" id="L307">    }</span>

    @Test
    void createBookingStartDateNotEqualsEndDateTest() {
<span class="fc" id="L311">        Mockito.when(userRepository.existsById(Mockito.anyLong())).thenReturn(true);</span>
<span class="fc" id="L312">        Mockito.when(userRepository.getReferenceById(Mockito.anyLong())).thenReturn(mockedUser);</span>
<span class="fc" id="L313">        Mockito.when(itemRepository.existsById(Mockito.anyLong())).thenReturn(true);</span>
<span class="fc" id="L314">        Mockito.when(itemRepository.getReferenceById(Mockito.anyLong())).thenReturn(mockedItem);</span>

<span class="fc" id="L316">        BookingDto bookingDto1 = new BookingDto();</span>
<span class="fc" id="L317">        bookingDto1.setItemId(1L);</span>
<span class="fc" id="L318">        bookingDto1.setStatus(BookingState.WAITING);</span>
<span class="fc" id="L319">        bookingDto1.setStart(LocalDateTime.of(2024, 11, 11, 11, 11, 11));</span>
<span class="fc" id="L320">        bookingDto1.setEnd(LocalDateTime.of(2025, 11, 11, 11, 11, 11));</span>

<span class="fc" id="L322">        Mockito.when(bookingMapper.mapFromDto(Mockito.any(BookingDto.class)))</span>
<span class="fc" id="L323">                .thenReturn(mockedBooking);</span>

<span class="fc" id="L325">        Mockito.when(bookingRepository.save(Mockito.eq(mockedBooking)))</span>
<span class="fc" id="L326">                .thenReturn(mockedBooking);</span>

        try {
<span class="fc" id="L329">            BookingDtoToReturn returnedDto = bookingServiceImpl.createBooking(1L, bookingDto1);</span>
<span class="fc" id="L330">            assertNotNull(returnedDto);</span>
<span class="fc" id="L331">            assertEquals(mockedBooking.getId(), returnedDto.getId());</span>
<span class="fc" id="L332">            assertEquals(mockedBooking.getItem(), returnedDto.getItem());</span>
<span class="fc" id="L333">            assertEquals(mockedBooking.getBooker(), returnedDto.getBooker());</span>
<span class="fc" id="L334">            assertEquals(mockedBooking.getStart(), returnedDto.getStart());</span>
<span class="fc" id="L335">            assertEquals(mockedBooking.getEnd(), returnedDto.getEnd());</span>
<span class="fc" id="L336">            assertEquals(BookingState.WAITING, returnedDto.getStatus());</span>
<span class="nc" id="L337">        } catch (BookingValidationException e) {</span>
<span class="nc" id="L338">            assertEquals(&quot;Booking start date cannot be equals booking end date&quot;, e.getMessage());</span>
<span class="fc" id="L339">        }</span>
<span class="fc" id="L340">    }</span>

    @Test
    void updateBookingApprovalTest_ValidationException_isMissing() {
        try {
<span class="nc" id="L345">            bookingServiceImpl.updateBookingApproval(1L, null, true);</span>
<span class="fc" id="L346">        } catch (MissingParameterException e) {</span>
<span class="fc" id="L347">            assertEquals(&quot;booking id is missing&quot;, e.getMessage());</span>
<span class="nc" id="L348">        }</span>
<span class="fc" id="L349">    }</span>

    @Test
    void updateBookingApprovalTest_ValidationException_IllegalArgument() {
        try {
<span class="nc" id="L354">            bookingServiceImpl.updateBookingApproval(1L, &quot;abc1&quot;, true);</span>
<span class="fc" id="L355">        } catch (IllegalArgumentException e) {</span>
<span class="fc" id="L356">            assertEquals(&quot;Invalid booking id: &quot; + &quot;abc1&quot;, e.getMessage());</span>
<span class="nc" id="L357">        }</span>
<span class="fc" id="L358">    }</span>

    @Test
    void updateBookingApproval_WrongUser() {

<span class="fc" id="L363">        Mockito.when(bookingServiceImpl.checkExitstingBooking(Mockito.anyLong()))</span>
<span class="fc" id="L364">                .thenReturn(mockedBooking);</span>

<span class="fc" id="L366">        Mockito.when(mockedBooking.getItem().getOwnerId())</span>
<span class="fc" id="L367">                .thenReturn(3L);</span>

        try {
<span class="nc" id="L370">            bookingServiceImpl.updateBookingApproval(1L, &quot;1&quot;, true);</span>
<span class="fc" id="L371">        } catch (WrongUserException e) {</span>
<span class="fc" id="L372">            assertEquals(&quot;You are not the owner of the item and cannot update the booking.&quot;, e.getMessage());</span>
<span class="nc" id="L373">        }</span>

<span class="fc" id="L375">        Mockito.when(mockedBooking.getItem().getOwnerId())</span>
<span class="fc" id="L376">                .thenReturn(1L);</span>
<span class="fc" id="L377">    }</span>

    @Test
    void updateBookingApprovalTest_Approved() {
<span class="fc" id="L381">        Mockito.when(mockedBooking.getStatus())</span>
<span class="fc" id="L382">                .thenReturn(BookingState.APPROVED);</span>

<span class="fc" id="L384">        Mockito.when(bookingServiceImpl.checkExitstingBooking(Mockito.eq(mockedBooking.getId())))</span>
<span class="fc" id="L385">                .thenReturn(mockedBooking);</span>

<span class="fc" id="L387">        Mockito.when(bookingRepository.save(Mockito.any(Booking.class)))</span>
<span class="fc" id="L388">                .thenReturn(mockedBooking);</span>

<span class="fc" id="L390">        Mockito.when(bookingMapper.mapToBookingDtoReturned(Mockito.any(Booking.class)))</span>
<span class="fc" id="L391">                .thenReturn(returnedBookingDto);</span>

<span class="fc" id="L393">        BookingDtoToReturn resultDto = bookingServiceImpl.updateBookingApproval(1L, &quot;1&quot;, true);</span>

<span class="fc" id="L395">        assertEquals(BookingState.APPROVED, resultDto.getStatus());</span>
<span class="fc" id="L396">    }</span>

    @Test
    void updateBookingApprovalTest_REJECTED() {
<span class="fc" id="L400">        Mockito.when(mockedBooking.getStatus())</span>
<span class="fc" id="L401">                .thenReturn(BookingState.REJECTED);</span>

<span class="fc" id="L403">        Mockito.when(bookingServiceImpl.checkExitstingBooking(Mockito.eq(mockedBooking.getId())))</span>
<span class="fc" id="L404">                .thenReturn(mockedBooking);</span>

<span class="fc" id="L406">        Mockito.when(bookingRepository.save(Mockito.any(Booking.class)))</span>
<span class="fc" id="L407">                .thenReturn(mockedBooking);</span>

<span class="fc" id="L409">        Mockito.when(bookingMapper.mapToBookingDtoReturned(Mockito.any(Booking.class)))</span>
<span class="fc" id="L410">                .thenReturn(returnedBookingDto);</span>

<span class="fc" id="L412">        BookingDtoToReturn resultDto = bookingServiceImpl.updateBookingApproval(1L, &quot;1&quot;, false);</span>

<span class="fc" id="L414">        assertEquals(BookingState.REJECTED, resultDto.getStatus());</span>
<span class="fc" id="L415">    }</span>

    @Test
    void findBookingById_NotExistedBooking() {
<span class="fc" id="L419">        Mockito.when(bookingRepository.getReferenceById(Mockito.anyLong()))</span>
<span class="fc" id="L420">                .thenThrow(EntityNotFoundException.class);</span>

        try {
<span class="nc" id="L423">            bookingServiceImpl.findBookingById(1L, 1L);</span>
<span class="fc" id="L424">        } catch (ElementNotFoundException e) {</span>
<span class="fc" id="L425">            assertEquals(&quot;Booking not found&quot;, e.getMessage());</span>
<span class="nc" id="L426">        }</span>
<span class="fc" id="L427">    }</span>

    @Test
    void getBookingInfo_OwnerAccess_Success() {

<span class="fc" id="L432">        Mockito.when(bookingServiceImpl.checkExitstingBooking(Mockito.anyLong())).thenReturn(mockedBooking);</span>

<span class="fc" id="L434">        Mockito.when(bookingMapper.mapToBookingDtoReturned(Mockito.eq(mockedBooking))).thenReturn(returnedBookingDto);</span>

<span class="fc" id="L436">        BookingDtoToReturn resultDto = bookingServiceImpl.findBookingById(1L, 1L);</span>

<span class="fc" id="L438">        assertEquals(returnedBookingDto, resultDto);</span>
<span class="fc" id="L439">    }</span>

    @Test
    void getBookingInfo_BookerAccess_Success() {
<span class="fc" id="L443">        Mockito.when(bookingServiceImpl.checkExitstingBooking(Mockito.anyLong())).thenReturn(mockedBooking);</span>

<span class="fc" id="L445">        BookingDtoToReturn expectedDto = new BookingDtoToReturn();</span>
<span class="fc" id="L446">        Mockito.when(bookingMapper.mapToBookingDtoReturned(mockedBooking)).thenReturn(expectedDto);</span>

<span class="fc" id="L448">        BookingDtoToReturn resultDto = bookingServiceImpl.findBookingById(1L, 1L);</span>

<span class="fc" id="L450">        assertEquals(expectedDto, resultDto);</span>
<span class="fc" id="L451">    }</span>

    @Test
    void getBookingInfo_WrongUser_ThrowsWrongUserException() {

<span class="fc" id="L456">        Mockito.when(mockedBooking.getBooker().getId())</span>
<span class="fc" id="L457">                .thenReturn(2L);</span>

<span class="fc" id="L459">        Mockito.when(mockedBooking.getItem().getOwnerId())</span>
<span class="fc" id="L460">                .thenReturn(3L);</span>

<span class="fc" id="L462">        Mockito.when(bookingServiceImpl.checkExitstingBooking(Mockito.anyLong())).thenReturn(mockedBooking);</span>

        try {
<span class="nc" id="L465">            bookingServiceImpl.findBookingById(1L, 1L);</span>
<span class="fc" id="L466">        } catch (WrongUserException e) {</span>
<span class="fc" id="L467">            assertEquals(&quot;Only owner or booker can get information about booking&quot;, e.getMessage());</span>
<span class="nc" id="L468">        }</span>

<span class="fc" id="L470">        Mockito.when(mockedBooking.getBooker().getId())</span>
<span class="fc" id="L471">                .thenReturn(1L);</span>

<span class="fc" id="L473">        Mockito.when(mockedBooking.getItem().getId())</span>
<span class="fc" id="L474">                .thenReturn(1L);</span>
<span class="fc" id="L475">    }</span>

    @Test
    void findByBookerIdAndStateSortedPastTest() {

<span class="fc" id="L480">        Mockito.when(bookingMapper.mapToBookingDtoReturned(Mockito.eq(checkBooking)))</span>
<span class="fc" id="L481">                .thenReturn(checkBookingDtoToReturn);</span>

<span class="fc" id="L483">        Mockito.when(bookingMapper.mapToBookingDtoReturned(Mockito.anyList()))</span>
<span class="fc" id="L484">                .thenReturn(List.of(checkBookingDtoToReturn));</span>

<span class="fc" id="L486">        Mockito.when(bookingRepository.findPastBookingsByBookerId(</span>
<span class="fc" id="L487">                        Mockito.anyLong(), Mockito.any(LocalDateTime.class)))</span>
<span class="fc" id="L488">                .thenReturn(List.of(checkBooking));</span>

<span class="fc" id="L490">        List&lt;BookingDtoToReturn&gt; result =</span>
<span class="fc" id="L491">                bookingServiceImpl.findByBookerIdAndStateSorted(1L, BookingStateSearchParams.PAST);</span>

<span class="fc" id="L493">        assertThat(result, Matchers.not(empty()));</span>
<span class="fc" id="L494">    }</span>

    @Test
    void findByBookerIdAndStateSortedFutureTest() {
<span class="fc" id="L498">        checkBooking.setStatus(BookingState.APPROVED);</span>

<span class="fc" id="L500">        checkBookingDtoToReturn = mapToReturn(</span>
<span class="fc" id="L501">                checkBooking.getId(),</span>
<span class="fc" id="L502">                checkBooking.getStart(),</span>
<span class="fc" id="L503">                checkBooking.getEnd(),</span>
<span class="fc" id="L504">                checkBooking.getBooker(),</span>
<span class="fc" id="L505">                checkBooking.getItem(),</span>
<span class="fc" id="L506">                checkBooking.getStatus()</span>
        );

<span class="fc" id="L509">        Mockito.when(bookingMapper.mapToBookingDtoReturned(Mockito.eq(checkBooking)))</span>
<span class="fc" id="L510">                .thenReturn(checkBookingDtoToReturn);</span>

<span class="fc" id="L512">        Mockito.when(bookingMapper.mapToBookingDtoReturned(Mockito.anyList()))</span>
<span class="fc" id="L513">                .thenReturn(List.of(checkBookingDtoToReturn));</span>

<span class="fc" id="L515">        Mockito.when(bookingRepository.findFutureBookingsByBookerId(</span>
<span class="fc" id="L516">                        Mockito.anyLong(), Mockito.any(LocalDateTime.class)))</span>
<span class="fc" id="L517">                .thenReturn(List.of(checkBooking));</span>

<span class="fc" id="L519">        List&lt;BookingDtoToReturn&gt; result =</span>
<span class="fc" id="L520">                bookingServiceImpl.findByBookerIdAndStateSorted(1L, BookingStateSearchParams.FUTURE);</span>

<span class="fc" id="L522">        assertThat(result, Matchers.not(empty()));</span>
<span class="fc" id="L523">    }</span>

    @Test
    void findByBookerIdAndStateSortedCurrentTest() {
<span class="fc" id="L527">        checkBooking.setStatus(BookingState.APPROVED);</span>

<span class="fc" id="L529">        checkBookingDtoToReturn = mapToReturn(</span>
<span class="fc" id="L530">                checkBooking.getId(),</span>
<span class="fc" id="L531">                checkBooking.getStart(),</span>
<span class="fc" id="L532">                checkBooking.getEnd(),</span>
<span class="fc" id="L533">                checkBooking.getBooker(),</span>
<span class="fc" id="L534">                checkBooking.getItem(),</span>
<span class="fc" id="L535">                checkBooking.getStatus()</span>
        );

<span class="fc" id="L538">        Mockito.when(bookingMapper.mapToBookingDtoReturned(Mockito.eq(checkBooking)))</span>
<span class="fc" id="L539">                .thenReturn(checkBookingDtoToReturn);</span>

<span class="fc" id="L541">        Mockito.when(bookingMapper.mapToBookingDtoReturned(Mockito.anyList()))</span>
<span class="fc" id="L542">                .thenReturn(List.of(checkBookingDtoToReturn));</span>

<span class="fc" id="L544">        Mockito.when(bookingRepository.findCurrentBookingsByBookerId(</span>
<span class="fc" id="L545">                        Mockito.anyLong(), Mockito.any(LocalDateTime.class)))</span>
<span class="fc" id="L546">                .thenReturn(List.of(checkBooking));</span>

<span class="fc" id="L548">        List&lt;BookingDtoToReturn&gt; result =</span>
<span class="fc" id="L549">                bookingServiceImpl.findByBookerIdAndStateSorted(1L, BookingStateSearchParams.CURRENT);</span>

<span class="fc" id="L551">        assertThat(result, Matchers.not(empty()));</span>
<span class="fc" id="L552">    }</span>

    @Test
    void findByBookerIdAndStateSortedWaitingTest() {
<span class="fc" id="L556">        checkBooking.setStatus(BookingState.WAITING);</span>

<span class="fc" id="L558">        checkBookingDtoToReturn = mapToReturn(</span>
<span class="fc" id="L559">                checkBooking.getId(),</span>
<span class="fc" id="L560">                checkBooking.getStart(),</span>
<span class="fc" id="L561">                checkBooking.getEnd(),</span>
<span class="fc" id="L562">                checkBooking.getBooker(),</span>
<span class="fc" id="L563">                checkBooking.getItem(),</span>
<span class="fc" id="L564">                checkBooking.getStatus()</span>
        );

<span class="fc" id="L567">        Mockito.when(bookingMapper.mapToBookingDtoReturned(Mockito.eq(checkBooking)))</span>
<span class="fc" id="L568">                .thenReturn(checkBookingDtoToReturn);</span>

<span class="fc" id="L570">        Mockito.when(bookingMapper.mapToBookingDtoReturned(Mockito.anyList()))</span>
<span class="fc" id="L571">                .thenReturn(List.of(checkBookingDtoToReturn));</span>

<span class="fc" id="L573">        Mockito.when(bookingRepository.findAllByBookerIdAndStatus(</span>
<span class="fc" id="L574">                        Mockito.anyLong(), Mockito.eq(BookingStateSearchParams.WAITING)))</span>
<span class="fc" id="L575">                .thenReturn(List.of(checkBooking));</span>

<span class="fc" id="L577">        List&lt;BookingDtoToReturn&gt; result =</span>
<span class="fc" id="L578">                bookingServiceImpl.findByBookerIdAndStateSorted(1L, BookingStateSearchParams.WAITING);</span>

<span class="fc" id="L580">        assertThat(result, Matchers.not(empty()));</span>
<span class="fc" id="L581">    }</span>

    @Test
    void findByBookerIdAndStateSortedRejectedTest() {
<span class="fc" id="L585">        checkBooking.setStatus(BookingState.REJECTED);</span>

<span class="fc" id="L587">        checkBookingDtoToReturn = mapToReturn(</span>
<span class="fc" id="L588">                checkBooking.getId(),</span>
<span class="fc" id="L589">                checkBooking.getStart(),</span>
<span class="fc" id="L590">                checkBooking.getEnd(),</span>
<span class="fc" id="L591">                checkBooking.getBooker(),</span>
<span class="fc" id="L592">                checkBooking.getItem(),</span>
<span class="fc" id="L593">                checkBooking.getStatus()</span>
        );

<span class="fc" id="L596">        Mockito.when(bookingMapper.mapToBookingDtoReturned(Mockito.eq(checkBooking)))</span>
<span class="fc" id="L597">                .thenReturn(checkBookingDtoToReturn);</span>

<span class="fc" id="L599">        Mockito.when(bookingMapper.mapToBookingDtoReturned(Mockito.anyList()))</span>
<span class="fc" id="L600">                .thenReturn(List.of(checkBookingDtoToReturn));</span>

<span class="fc" id="L602">        Mockito.when(bookingRepository.findAllByBookerIdAndStatus(</span>
<span class="fc" id="L603">                        Mockito.anyLong(), Mockito.eq(BookingStateSearchParams.REJECTED)))</span>
<span class="fc" id="L604">                .thenReturn(List.of(checkBooking));</span>

<span class="fc" id="L606">        List&lt;BookingDtoToReturn&gt; result = bookingServiceImpl.findByBookerIdAndStateSorted(1L, BookingStateSearchParams.REJECTED);</span>

<span class="fc" id="L608">        assertThat(result, Matchers.not(empty()));</span>
<span class="fc" id="L609">    }</span>

    @Test
    void findByBookerIdAndStateSortedDefaultTest() {
<span class="fc" id="L613">        checkBooking.setStatus(BookingState.WAITING);</span>

<span class="fc" id="L615">        checkBookingDtoToReturn = mapToReturn(</span>
<span class="fc" id="L616">                checkBooking.getId(),</span>
<span class="fc" id="L617">                checkBooking.getStart(),</span>
<span class="fc" id="L618">                checkBooking.getEnd(),</span>
<span class="fc" id="L619">                checkBooking.getBooker(),</span>
<span class="fc" id="L620">                checkBooking.getItem(),</span>
<span class="fc" id="L621">                checkBooking.getStatus()</span>
        );

<span class="fc" id="L624">        Mockito.when(bookingMapper.mapToBookingDtoReturned(Mockito.eq(checkBooking)))</span>
<span class="fc" id="L625">                .thenReturn(checkBookingDtoToReturn);</span>

<span class="fc" id="L627">        Mockito.when(bookingMapper.mapToBookingDtoReturned(Mockito.anyList()))</span>
<span class="fc" id="L628">                .thenReturn(List.of(checkBookingDtoToReturn));</span>

<span class="fc" id="L630">        Mockito.when(bookingRepository.findAllByBookerId(Mockito.anyLong()))</span>
<span class="fc" id="L631">                .thenReturn(List.of(checkBooking));</span>

<span class="fc" id="L633">        List&lt;BookingDtoToReturn&gt; result = bookingServiceImpl.findByBookerIdAndStateSorted(1L, BookingStateSearchParams.ALL);</span>

<span class="fc" id="L635">        assertEquals(1, result.size());</span>
<span class="fc" id="L636">    }</span>

    //----------------------------------------------

    @Test
    void findAllByBookingItemOwnerIdAndStatusTest_PAST() {

<span class="fc" id="L643">        Mockito.when(itemRepository.existsById(Mockito.anyLong())).thenReturn(true);</span>

<span class="fc" id="L645">        User userForTest = new User();</span>
<span class="fc" id="L646">        userForTest.setName(&quot;User1&quot;);</span>
<span class="fc" id="L647">        userForTest.setId(1L);</span>
<span class="fc" id="L648">        userForTest.setEmail(&quot;userEmail&quot;);</span>

<span class="fc" id="L650">        Item itemForTest = new Item();</span>
<span class="fc" id="L651">        itemForTest.setId(1L);</span>
<span class="fc" id="L652">        itemForTest.setOwnerId(1L);</span>
<span class="fc" id="L653">        itemForTest.setAvailable(true);</span>
<span class="fc" id="L654">        itemForTest.setDescription(&quot;Item1&quot;);</span>
<span class="fc" id="L655">        itemForTest.setRequest(new Request());</span>

<span class="fc" id="L657">        Booking bookingForTest = new Booking();</span>
<span class="fc" id="L658">        bookingForTest.setId(1L);</span>
<span class="fc" id="L659">        bookingForTest.setItem(itemForTest);</span>
<span class="fc" id="L660">        bookingForTest.setBooker(userForTest);</span>
<span class="fc" id="L661">        bookingForTest.setStatus(BookingState.CANCELED);</span>

<span class="fc" id="L663">        BookingDto dto = new BookingDto();</span>
<span class="fc" id="L664">        dto.setItemId(bookingForTest.getItem().getId());</span>
<span class="fc" id="L665">        dto.setStart(bookingForTest.getStart());</span>
<span class="fc" id="L666">        dto.setEnd(bookingForTest.getEnd());</span>
<span class="fc" id="L667">        dto.setStatus(bookingForTest.getStatus());</span>

<span class="fc" id="L669">        bookingForTest.setStart(LocalDateTime.of(2023, 12, 12, 12, 12, 12));</span>
<span class="fc" id="L670">        bookingForTest.setEnd(LocalDateTime.of(2024, 12, 12, 12, 12, 12));</span>

<span class="fc" id="L672">        Mockito.when(bookingMapper.mapToDto(Mockito.eq(bookingForTest)))</span>
<span class="fc" id="L673">                .thenReturn(dto);</span>

<span class="fc" id="L675">        Mockito.when(bookingMapper.mapToListDto(Mockito.anyList()))</span>
<span class="fc" id="L676">                .thenReturn(List.of(dto));</span>

<span class="fc" id="L678">        Mockito.when(bookingRepository.findPastBookingsByOwnerId(Mockito.anyLong(), Mockito.eq(LocalDateTime.now())))</span>
<span class="fc" id="L679">                .thenReturn(List.of(bookingForTest));</span>

<span class="fc" id="L681">        List&lt;BookingDto&gt; result = bookingServiceImpl.findAllByBookingItemOwnerIdAndStatus(1L, BookingStateSearchParams.PAST);</span>

<span class="fc" id="L683">        assertThat(result, Matchers.not(empty()));</span>
<span class="fc" id="L684">        assertThat(result.size(), Matchers.is(1));</span>
<span class="fc" id="L685">    }</span>

//    @Test
//    void findAllByBookingItemOwnerIdAndStatusTest_PAST() {
//
//        Mockito.when(userRepository.existsById(Mockito.anyLong())).thenReturn(true);
//        Mockito.when(itemRepository.existsById(Mockito.anyLong())).thenReturn(true);
//
//        User userForTest = new User();
//        userForTest.setName(&quot;User1&quot;);
//        userForTest.setId(1L);
//        userForTest.setEmail(&quot;userEmail&quot;);
//
//        Item itemForTest = new Item();
//        itemForTest.setId(1L);
//        itemForTest.setName(&quot;Item1&quot;);
//        itemForTest.setOwnerId(1L);
//        itemForTest.setAvailable(true);
//        itemForTest.setDescription(&quot;Item1&quot;);
//        itemForTest.setRequest(new Request());
//
//        Booking bookingForTest = new Booking();
//        bookingForTest.setId(1L);
//        bookingForTest.setItem(itemForTest);
//        bookingForTest.setBooker(userForTest);
//        bookingForTest.setStart(LocalDateTime.of(2023, 12, 12, 12, 12, 12));
//        bookingForTest.setEnd(LocalDateTime.of(2024, 12, 12, 12, 12, 12));
//
//        BookingDto dto = new BookingDto();
//        dto.setItemId(itemForTest.getId());
//        dto.setStart(bookingForTest.getStart());
//        dto.setEnd(bookingForTest.getEnd());
//
//        List&lt;Booking&gt; list = List.of(bookingForTest);
//
//        Mockito.when(bookingMapper.mapToDto(Mockito.eq(bookingForTest)))
//                .thenReturn(dto);
//
//        Mockito.when(bookingMapper.mapToListDto(list))
//                .thenReturn(List.of(dto));
//
//        Mockito.when(bookingRepository.findPastBookingsByOwnerId(
//                        Mockito.anyLong(), Mockito.eq(
//                                LocalDateTime.now())))
//                .thenReturn(List.of(bookingForTest));
//
//        List&lt;BookingDto&gt; result =
//                bookingServiceImpl.findAllByBookingItemOwnerIdAndStatus(1L, BookingStateSearchParams.PAST);
//
//        assertThat(result, Matchers.not(empty()));
//    }
//
//    @Test
//    void findAllByBookingItemOwnerIdAndStatusTest_FUTURE() {
//
//        Mockito.when(userRepository.existsById(Mockito.anyLong())).thenReturn(true);
//        Mockito.when(itemRepository.existsById(Mockito.anyLong())).thenReturn(true);
//
//        User userForTest = new User();
//        userForTest.setName(&quot;User1&quot;);
//        userForTest.setId(1L);
//        userForTest.setEmail(&quot;userEmail&quot;);
//
//        Item itemForTest = new Item();
//        itemForTest.setId(1L);
//        itemForTest.setOwnerId(1L);
//        itemForTest.setAvailable(true);
//        itemForTest.setDescription(&quot;Item1&quot;);
//        itemForTest.setRequest(new Request());
//
//        Booking bookingForTest = new Booking();
//        bookingForTest.setId(1L);
//        bookingForTest.setItem(itemForTest);
//        bookingForTest.setBooker(userForTest);
//        bookingForTest.setStart(LocalDateTime.of(2026, 12, 12, 12, 12, 12));
//        bookingForTest.setEnd(null);
//
//        BookingDto dto = new BookingDto();
//        dto.setItemId(itemForTest.getId());
//        dto.setStart(bookingForTest.getStart());
//        dto.setEnd(bookingForTest.getEnd());
//
//        List&lt;Booking&gt; list = List.of(bookingForTest);
//
//        Mockito.when(bookingMapper.mapToDto(Mockito.eq(bookingForTest)))
//                .thenReturn(dto);
//
//        Mockito.when(bookingMapper.mapToListDto(list))
//                .thenReturn(List.of(dto));
//
//        Mockito.when(bookingRepository.findFutureBookingsByOwnerId(Mockito.anyLong(), Mockito.eq(LocalDateTime.now())))
//                .thenReturn(List.of(bookingForTest));
//
//        List&lt;BookingDto&gt; result =
//                bookingServiceImpl.findAllByBookingItemOwnerIdAndStatus(1L, BookingStateSearchParams.FUTURE);
//
//        assertThat(result, Matchers.not(empty()));
//    }
//
//    @Test
//    void findAllByBookingItemOwnerIdAndStatusTest_CURRENT() {
//        Mockito.when(userRepository.existsById(Mockito.anyLong())).thenReturn(true);
//        Mockito.when(itemRepository.existsById(Mockito.anyLong())).thenReturn(true);
//
//        User userForTest = new User();
//        userForTest.setName(&quot;User1&quot;);
//        userForTest.setId(1L);
//        userForTest.setEmail(&quot;userEmail&quot;);
//
//        Item itemForTest = new Item();
//        itemForTest.setId(1L);
//        itemForTest.setOwnerId(1L);
//        itemForTest.setAvailable(false);
//        itemForTest.setDescription(&quot;Item1&quot;);
//        itemForTest.setRequest(new Request());
//
//        Booking bookingForTest = new Booking();
//        bookingForTest.setId(1L);
//        bookingForTest.setItem(itemForTest);
//        bookingForTest.setBooker(userForTest);
//        bookingForTest.setStart(LocalDateTime.of(2023, 12, 12, 12, 12, 12));
//        bookingForTest.setEnd(LocalDateTime.of(2027, 12, 12, 12, 12, 12));
//
//        BookingDto dto = new BookingDto();
//        dto.setItemId(itemForTest.getId());
//        dto.setStart(bookingForTest.getStart());
//        dto.setEnd(bookingForTest.getEnd());
//
//        List&lt;Booking&gt; list = List.of(bookingForTest);
//
//        Mockito.when(bookingMapper.mapToDto(Mockito.eq(bookingForTest)))
//                .thenReturn(dto);
//
//        Mockito.when(bookingMapper.mapToListDto(list))
//                .thenReturn(List.of(dto));
//
//        Mockito.when(bookingRepository.findCurrentBookingsByOwnerId(Mockito.anyLong(), Mockito.eq(LocalDateTime.now())))
//                .thenReturn(List.of(bookingForTest));
//
//        List&lt;BookingDto&gt; result =
//                bookingServiceImpl.findAllByBookingItemOwnerIdAndStatus(1L, BookingStateSearchParams.CURRENT);
//
//        assertThat(result, Matchers.not(empty()));
//    }

    @Test
    void findAllByBookingItemOwnerIdAndStatusTest_WAITING() {

<span class="fc" id="L833">        User userForTest = new User();</span>
<span class="fc" id="L834">        userForTest.setName(&quot;User1&quot;);</span>
<span class="fc" id="L835">        userForTest.setId(1L);</span>
<span class="fc" id="L836">        userForTest.setEmail(&quot;userEmail&quot;);</span>

<span class="fc" id="L838">        Item itemForTest = new Item();</span>
<span class="fc" id="L839">        itemForTest.setId(1L);</span>
<span class="fc" id="L840">        itemForTest.setOwnerId(1L);</span>
<span class="fc" id="L841">        itemForTest.setAvailable(false);</span>
<span class="fc" id="L842">        itemForTest.setDescription(&quot;Item1&quot;);</span>
<span class="fc" id="L843">        itemForTest.setRequest(new Request());</span>

<span class="fc" id="L845">        Booking bookingForTest = new Booking();</span>
<span class="fc" id="L846">        bookingForTest.setId(1L);</span>
<span class="fc" id="L847">        bookingForTest.setItem(itemForTest);</span>
<span class="fc" id="L848">        bookingForTest.setBooker(userForTest);</span>
<span class="fc" id="L849">        bookingForTest.setStatus(BookingState.WAITING);</span>
<span class="fc" id="L850">        bookingForTest.setStart(LocalDateTime.of(2023, 12, 12, 12, 12, 12));</span>
<span class="fc" id="L851">        bookingForTest.setEnd(LocalDateTime.of(2027, 12, 12, 12, 12, 12));</span>

<span class="fc" id="L853">        BookingDto dto = new BookingDto();</span>
<span class="fc" id="L854">        dto.setItemId(itemForTest.getId());</span>
<span class="fc" id="L855">        dto.setStart(bookingForTest.getStart());</span>
<span class="fc" id="L856">        dto.setEnd(bookingForTest.getEnd());</span>
<span class="fc" id="L857">        dto.setStatus(bookingForTest.getStatus());</span>

<span class="fc" id="L859">        List&lt;Booking&gt; list = List.of(bookingForTest);</span>

<span class="fc" id="L861">        Mockito.when(bookingRepository.findAllByOwnerIdAndStatus(</span>
<span class="fc" id="L862">                        Mockito.anyLong(), Mockito.eq(BookingStateSearchParams.WAITING)))</span>
<span class="fc" id="L863">                .thenReturn(List.of(bookingForTest));</span>

<span class="fc" id="L865">        Mockito.when(bookingMapper.mapToListDto(list))</span>
<span class="fc" id="L866">                .thenReturn(List.of(dto));</span>

<span class="fc" id="L868">        List&lt;BookingDto&gt; result =</span>
<span class="fc" id="L869">                bookingServiceImpl.findAllByBookingItemOwnerIdAndStatus(1L, BookingStateSearchParams.WAITING);</span>

<span class="fc" id="L871">        assertThat(result, Matchers.not(empty()));</span>
<span class="fc" id="L872">    }</span>

    @Test
    void findAllByBookingItemOwnerIdAndStatusTest_REJECTED() {

<span class="fc" id="L877">        User userForTest = new User();</span>
<span class="fc" id="L878">        userForTest.setName(&quot;User1&quot;);</span>
<span class="fc" id="L879">        userForTest.setId(1L);</span>
<span class="fc" id="L880">        userForTest.setEmail(&quot;userEmail&quot;);</span>

<span class="fc" id="L882">        Item itemForTest = new Item();</span>
<span class="fc" id="L883">        itemForTest.setId(1L);</span>
<span class="fc" id="L884">        itemForTest.setOwnerId(1L);</span>
<span class="fc" id="L885">        itemForTest.setAvailable(false);</span>
<span class="fc" id="L886">        itemForTest.setDescription(&quot;Item1&quot;);</span>
<span class="fc" id="L887">        itemForTest.setRequest(new Request());</span>

<span class="fc" id="L889">        Booking bookingForTest = new Booking();</span>
<span class="fc" id="L890">        bookingForTest.setId(1L);</span>
<span class="fc" id="L891">        bookingForTest.setItem(itemForTest);</span>
<span class="fc" id="L892">        bookingForTest.setBooker(userForTest);</span>
<span class="fc" id="L893">        bookingForTest.setStatus(BookingState.REJECTED);</span>
<span class="fc" id="L894">        bookingForTest.setStart(LocalDateTime.of(2023, 12, 12, 12, 12, 12));</span>
<span class="fc" id="L895">        bookingForTest.setEnd(LocalDateTime.of(2027, 12, 12, 12, 12, 12));</span>

<span class="fc" id="L897">        BookingDto dto = new BookingDto();</span>
<span class="fc" id="L898">        dto.setItemId(itemForTest.getId());</span>
<span class="fc" id="L899">        dto.setStart(bookingForTest.getStart());</span>
<span class="fc" id="L900">        dto.setEnd(bookingForTest.getEnd());</span>
<span class="fc" id="L901">        dto.setStatus(bookingForTest.getStatus());</span>

<span class="fc" id="L903">        List&lt;Booking&gt; list = List.of(bookingForTest);</span>

<span class="fc" id="L905">        Mockito.when(bookingRepository.findAllByOwnerIdAndStatus(</span>
<span class="fc" id="L906">                        Mockito.anyLong(), Mockito.eq(BookingStateSearchParams.REJECTED)))</span>
<span class="fc" id="L907">                .thenReturn(List.of(bookingForTest));</span>

<span class="fc" id="L909">        Mockito.when(bookingMapper.mapToListDto(list))</span>
<span class="fc" id="L910">                .thenReturn(List.of(dto));</span>

<span class="fc" id="L912">        List&lt;BookingDto&gt; result =</span>
<span class="fc" id="L913">                bookingServiceImpl.findAllByBookingItemOwnerIdAndStatus(1L, BookingStateSearchParams.REJECTED);</span>

<span class="fc" id="L915">        assertThat(result, Matchers.not(empty()));</span>
<span class="fc" id="L916">    }</span>

    @Test
    void findAllByBookingItemOwnerIdAndStatusTest_DEFAULT() {

<span class="fc" id="L921">        User userForTest = new User();</span>
<span class="fc" id="L922">        userForTest.setName(&quot;User1&quot;);</span>
<span class="fc" id="L923">        userForTest.setId(1L);</span>
<span class="fc" id="L924">        userForTest.setEmail(&quot;userEmail&quot;);</span>

<span class="fc" id="L926">        Item itemForTest = new Item();</span>
<span class="fc" id="L927">        itemForTest.setId(1L);</span>
<span class="fc" id="L928">        itemForTest.setOwnerId(1L);</span>
<span class="fc" id="L929">        itemForTest.setAvailable(false);</span>
<span class="fc" id="L930">        itemForTest.setDescription(&quot;Item1&quot;);</span>
<span class="fc" id="L931">        itemForTest.setRequest(new Request());</span>

<span class="fc" id="L933">        Booking bookingForTest = new Booking();</span>
<span class="fc" id="L934">        bookingForTest.setId(1L);</span>
<span class="fc" id="L935">        bookingForTest.setItem(itemForTest);</span>
<span class="fc" id="L936">        bookingForTest.setBooker(userForTest);</span>
<span class="fc" id="L937">        bookingForTest.setStatus(BookingState.APPROVED);</span>
<span class="fc" id="L938">        bookingForTest.setStart(LocalDateTime.of(2023, 12, 12, 12, 12, 12));</span>
<span class="fc" id="L939">        bookingForTest.setEnd(LocalDateTime.of(2027, 12, 12, 12, 12, 12));</span>

<span class="fc" id="L941">        BookingDto dto = new BookingDto();</span>
<span class="fc" id="L942">        dto.setItemId(itemForTest.getId());</span>
<span class="fc" id="L943">        dto.setStart(bookingForTest.getStart());</span>
<span class="fc" id="L944">        dto.setEnd(bookingForTest.getEnd());</span>
<span class="fc" id="L945">        dto.setStatus(bookingForTest.getStatus());</span>

<span class="fc" id="L947">        List&lt;Booking&gt; list = List.of(bookingForTest);</span>

<span class="fc" id="L949">        Mockito.when(bookingRepository.findAllByOwnerIdAndStatus(</span>
<span class="fc" id="L950">                        Mockito.anyLong(), Mockito.eq(BookingStateSearchParams.ALL)))</span>
<span class="fc" id="L951">                .thenReturn(List.of(bookingForTest));</span>

<span class="fc" id="L953">        Mockito.when(bookingMapper.mapToListDto(list))</span>
<span class="fc" id="L954">                .thenReturn(List.of(dto));</span>

<span class="fc" id="L956">        Mockito.when(bookingRepository.findAllByItemOwnerId(</span>
<span class="fc" id="L957">                        Mockito.anyLong()))</span>
<span class="fc" id="L958">                .thenReturn(List.of(bookingForTest));</span>

<span class="fc" id="L960">        List&lt;BookingDto&gt; result =</span>
<span class="fc" id="L961">                bookingServiceImpl.findAllByBookingItemOwnerIdAndStatus(1L, BookingStateSearchParams.ALL);</span>

<span class="fc" id="L963">        assertThat(result, Matchers.not(empty()));</span>
<span class="fc" id="L964">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.13.202504020838</span></div></body></html>